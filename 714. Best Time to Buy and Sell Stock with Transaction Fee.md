```python
#討論區解答
class Solution:
    def maxProfit(self, prices: List[int], fee: int) -> int:
        max_profit, min_price, pre_min_price = [0], float('inf'), float('inf')
        for i in range(len(prices)):
            min_price = min(min_price, prices[i])
            profit = prices[i] - min_price - fee
            merge_profit = prices[i] - pre_min_price -fee
            if merge_profit > max_profit[-1] + profit and merge_profit > max_profit[-1]:
                max_profit[-1] = merge_profit
                min_price = float('inf')
            elif profit > 0:
                max_profit.append(profit)
                pre_min_price = min_price
                min_price = float('inf')
            
        return sum(max_profit)

```